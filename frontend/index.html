<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MDO Smart Document Finder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Top bar with company brand on the right -->
  <div class="topbar">
    <div class="container topbar-inner">
      <div class="topbar-left"><!-- optional left content --></div>
      <div class="topbar-right">
        <img src="assets/image.png" alt="Western Heat and Forge Pvt Ltd." class="brand-logo" />
        <span class="brand-name">Western Heat and Forge Pvt Ltd.</span>
      </div>
    </div>
  </div>

  <!-- Centered hero header -->
  <header class="container hero">
    <h1>MDO Smart Document Finder</h1>
  </header>

  <section class="container card">
    <div class="filters">
      <div class="field">
        <label for="year">Year</label>
        <select id="year">
          <option value="">Any</option>
        </select>
      </div>

      <div class="field">
        <label for="month">Month</label>
        <select id="month">
          <option value="">Any</option>
          <option>January</option><option>February</option><option>March</option>
          <option>April</option><option>May</option><option>June</option>
          <option>July</option><option>August</option><option>September</option>
          <option>October</option><option>November</option><option>December</option>
        </select>
      </div>

      <div class="field grow">
        <label for="company">Company (in filename)</label>
        <input id="company" type="text" placeholder="e.g., Cameron, AVK, etc. " />
      </div>
    </div>

    <div class="search-row">
      <!-- Keep a single input with id="query" so app.js keeps working -->
      <input
        id="query"
        class="search-input"
        type="text"
        placeholder='Enter document number (e.g., 264)'
        autocomplete="off"
      />
      <button id="btnSearch" class="btn primary">Search</button>
      <button id="btnClear" class="btn">Clear</button>
    </div>

    <div id="status" class="status"></div>

    <div class="table-wrap">
      <table id="results" class="table hidden">
        <thead>
          <tr>
            <th>File name</th>
            <th>Parent folder</th>
            <th>Open</th>
            <th>Preview</th>
            <th>Copy</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="empty" class="empty hidden">
        <div class="empty-icon">ðŸ”Ž</div>
        <div class="empty-text">Document not found. Try fewer words or just the number (e.g., 264).</div>
      </div>
    </div>

    <div class="pagination hidden" id="pager">
      <div class="pager-left">
        <button id="prev" class="btn" disabled>â—€ Prev</button>
        <span id="pageInfo">Page 1 of 1</span>
        <button id="next" class="btn" disabled>Next â–¶</button>
      </div>
      <div class="pager-right">
        <label for="pageSize">Per page</label>
        <select id="pageSize">
          <option>25</option>
          <option selected>50</option>
          <option>100</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Lock "EXP-" prefix in the query input -->
  <script>
    (function () {
      const PREFIX = "EXP-";
      const input = document.getElementById("query");
      const btnClear = document.getElementById("btnClear");

      // Initialize with prefix if empty or if file preloads old value
      function ensurePrefix() {
        if (!input.value || !input.value.startsWith(PREFIX)) {
          input.value = PREFIX;
        }
        placeCaretAtEnd();
      }

      function placeCaretAtEnd() {
        // keep caret after the current text (usually right after prefix or user text)
        const len = input.value.length;
        requestAnimationFrame(() => {
          input.setSelectionRange(len, len);
        });
      }

      // Prevent deleting or moving caret into the prefix
      input.addEventListener("keydown", (e) => {
        const start = input.selectionStart ?? 0;
        const end = input.selectionEnd ?? 0;

        // Block Backspace/Delete if it would edit inside the prefix
        const atOrBeforePrefix = start <= PREFIX.length;
        const selectionStartsInPrefix = start < PREFIX.length;
        const selectionEndsInPrefix = end <= PREFIX.length;

        // Backspace directly after prefix
        if (e.key === "Backspace" && atOrBeforePrefix) {
          e.preventDefault();
          input.setSelectionRange(PREFIX.length, PREFIX.length);
          return;
        }

        // Delete while caret/selection is inside prefix
        if (e.key === "Delete" && (selectionStartsInPrefix || selectionEndsInPrefix)) {
          e.preventDefault();
          input.setSelectionRange(PREFIX.length, PREFIX.length);
          return;
        }

        // ArrowLeft/Home: don't allow caret to go inside prefix
        if ((e.key === "ArrowLeft" || e.key === "Home") && atOrBeforePrefix) {
          e.preventDefault();
          input.setSelectionRange(PREFIX.length, PREFIX.length);
          return;
        }
      });

      // On input, re-add prefix if the user pasted over it, etc.
      input.addEventListener("input", () => {
        if (!input.value.startsWith(PREFIX)) {
          const user = input.value.replace(/^EXP-?/i, ""); // strip any variant
          input.value = PREFIX + user;
        }
      });

      // On focus, keep caret after prefix if user focuses at start
      input.addEventListener("focus", () => {
        if ((input.selectionStart ?? 0) < PREFIX.length) {
          input.setSelectionRange(PREFIX.length, PREFIX.length);
        }
      });

      // Clear button resets to just the prefix (so search acts like empty)
      if (btnClear) {
        btnClear.addEventListener("click", () => {
          input.value = PREFIX;
          placeCaretAtEnd();
        });
      }

      // Set initial state
      ensurePrefix();
    })();
  </script>

  <script src="app.js?v=10"></script>
</body>
</html>
